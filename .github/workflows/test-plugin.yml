name: Test - Plugin

on:
  push:
    branches:
      - main
    paths:
      - 'object-lease-console-plugin/**'
  pull_request:
    paths:
      - 'object-lease-console-plugin/**'

permissions:
  contents: read

jobs:
  plugin-build:
    name: Build console plugin image
    runs-on: ubuntu-latest
    steps:
      - name: Clone the code
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

      - name: Set up Docker Buildx (for better caching, even though we use docker build)
        uses: docker/setup-buildx-action@8d2750c68a42422c14e847fe6c8ac0403b4cbd6f # v3

      - name: Build plugin image (no push)
        run: make plugin-build
        env:
          # Tag to avoid collisions across concurrent runs; not pushed
          PLUGIN_IMG: ghcr.io/ullbergm/object-lease-console-plugin:test-${{ github.run_id }}
